<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>3D</title>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<meta name = "format-detection" content="telephone = no" />
<link rel="stylesheet" type="text/css" href="../../css/style.css?v=20180131"/>
<style>
.xlld-box1 {
    background: #ffebed;
}
.xlld-title {
    font-size: 1.4em;
    line-height: 2.4em;
    text-align: center;
    font-weight: bold;
}
.xllr {
    position: relative;
    padding: .5em .8em;
}
.xllr .xll {
    min-height: 1em;
}
.xllr .xlr {
    position: absolute;
    top: 50%;
    right: .8em;
    margin-top: -.5em;
}
.xlld-p1 {
    padding: .3em .8em;
    font-weight: bold;
}
.xlld-p2 {
    font-weight: bold;
    text-align: right;
    padding: .5em .8em;
}
.xlld-p3 {
    padding: 0 .8em;
}

.xlld-box2 {
    padding: 1em;
}
.xlld-box2 .xl-btn {
	position: relative;
    float: right;
    background: #ff5534;
    border: 0;
    border-radius: .3em;
    padding: .8em 1.6em;
    color: #fff;
}
.xlld-box2 .xl-btn:first-child {
    float: left;
}

.xlld-box3 {
    position: relative;
    padding: .5em .8em;
    background: #fff;
}
.xlld-box3 .icon-forward {
    position: absolute;
    top: 50%;
    right: .8em;
    margin-top: -.5em;
    font-size: 2em;
}
.xlld-box3 .xlld-p4 span {
    float: left;
    height: 2em;
    width: 2em;
    border-radius: 2em;
    background: #fe0000;
    text-align: center;
    line-height: 2em;
    color: #fff;
    margin-left: .5em;
}
.xlld-box3 .xlld-p4 span:first-child {
    margin-left: 0;
}
.xlld-box3 .xlld-p4 span.blue {
    background: #00b8ee;
}

.xlld-down {
	position: absolute;
	left: 5%;
	top: 90%;
	width: 90%;
	height: 0;
	overflow: hidden;
	background: #fff;
	border-radius: .5em;
	transition: all .3s;
}
.xlld-down a {
	display: block;
	line-height: 24px;
	text-align: center;
	color: #545454;
	border-top: solid 1px #ccc;
}
.xlld-down a:first-child {
	border-top-color: transparent;
}

.xlld-p5 {
	text-align: center;
	color: #ff5534;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">3D</h1>
	</div>
</div>
<div class="xlbody-box">
    <div class="xlld-box1">
        <div class="xlld-title">3D</div>
        <div id="lotteryCode"></div>
        <div style="height: 1em;"></div>
    </div>
    <div style="height: 3px;"></div>
    <div class="xlld-box3 hidden" id="drawNumbers"></div>
    <div style="height: 1em;"></div>
    <div class="lottery_limit xlld-p5">恭喜您获得00双色球积分，您今日的双色球扫票次数还剩00次!</div>
    <div style="height: 1em;"></div>
    <div class="xlld-box2 clearfix">
        <div class="xl-btn slid_btn_box">
        	扫描记录<span class="caret"></span>
        	<div class="xlld-down">
        		<a href="../game/game_list.html">积分玩游戏</a>
        		<a href="../weixinmp/shopping_ds.html">积分兑商品</a>
        	</div>
        </div>
        <a class="xl-btn" href="../weixinmp/home.html?scanQRCode=yes">继续扫描</a>
    </div>
</div>

<script id="listTemplate"  type="text/template">
{{?(it.gameType==true)}}
        {{?(it.playTypeID == '2061')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选包胆</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.{{=item.numR1Txt}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2617')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：猜大小</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2071')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选包串</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numR1Txt}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2000')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单式</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}} {{=item.numArr[1]}} {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2120')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选跨度</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2051')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选包点</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2272')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选组合</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}+ {{=item.numArr[1]}}+ {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2040')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选包号</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.* * *【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2610')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法:猜1D</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.{{=item.numArr[0]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2230')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法:通选</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.{{=item.numArr[0]}} {{=item.numArr[1]}} {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>

        {{??(it.playTypeID == '2122')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：组选六跨度</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.{{=item.numArr[0]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2618')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：猜奇偶</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2616')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：拖拉机</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.拖拉机【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2615')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：猜三同</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}.三同号【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2613')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：包选三</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}} {{=item.numArr[1]}} {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2010')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：组三</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}+ {{=item.numArr[1]}}+ {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2612')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：包选</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}} {{=item.numArr[1]}} {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2614')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：包选六</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}} {{=item.numArr[1]}} {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2011')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：组六</div>
            </div>
            {{~it.bets:item:ii}}
            <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}+ {{=item.numArr[1]}}+ {{=item.numArr[2]}}【{{=item.multiTimes}}倍】</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2111')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：组选胆拖</div>
            </div>
            {{~it.bets:item}}
            <div class="xlld-p1">胆：{{~item.numArrR1:v1}}{{=v1}}　{{~}}</div>
            <div class="xlld-p1">拖：{{~item.numArrB1:v2}}{{=v2}}　{{~}}</div>
            <div class="xlld-p1">倍数：{{=item.multiTimes}}</div>
            {{~}}
        </div>
        {{??(it.playTypeID == '2110')}}
        <div class="xlld-game-type">
            <div class="xllr">
                <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
                <div class="xlr">玩法：单选胆拖</div>
            </div>
            {{~it.bets:item}}
            <div class="xlld-p1">胆：{{~item.numArrR1:v1}}{{=v1}}　{{~}}</div>
            <div class="xlld-p1">拖：{{~item.numArrB1:v2}}{{=v2}}　{{~}}</div>
            <div class="xlld-p1">倍数：{{=item.multiTimes}}</div>
            {{~}}
        </div>
    {{?}}
    {{??(it.gameType==false)}}
    <div class="xlld-game-type">
        <div class="xllr">
            <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
            <div class="xlr">玩法：混合单式</div>
        </div>
        {{~it.bets:item:ii}}
        	{{?(item.playTypeID==2000)}}
        	<div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}  {{=item.numArr[1]}}  {{=item.numArr[2]}} 单【{{=item.multiTimes}}倍】</div>
        	{{??(item.playTypeID==2011)||(item.playTypeID==2010)}}
       		<div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}+ {{=item.numArr[1]}}+{{=item.numArr[2]}} 组【{{=item.multiTimes}}倍】</div>
        	{{?}}
        {{~}}
    </div>
    {{?}}
    <div class="xlld-p2">金额：{{=it.parValue}}元</div>
  
</script>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/doT.min.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script>
"use strict";
globalData.isProgress = false;
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});
//页面启动时，数据初始化
function pageDataInit(){
    var lotteryData,
        numStr = '',
        play=[],
        numCode;
    try{
    	lotteryData = JSON.parse(decodeURIComponent(globalData.pageParam.lotteryData));
    	lotteryData.bets = JSON.parse(lotteryData.bets);
    }catch(err){
    	return false;
    }
    lotteryData.playTypeID = lotteryData.bets[0].playTypeID;
    $.each(lotteryData.bets, function(index, obj){
            if(play.indexOf(obj.playTypeID) < 0){
                    play[play.length] = obj.playTypeID;
              }	
                obj.numArr = [];
                $.each(obj.betNum.split(''), function(i, v) {
                    if (i % 2 == 0) {
                        numStr = (v + '');
                    } else {
                        numStr += (v + '');
                        numCode = parseInt(numStr, 16);
                        if(obj.playTypeID == '2120' || obj.playTypeID == '2051'|| obj.playTypeID == '2122'){
                            if(numCode < 10){
                                numCode = ('0' + numCode);
                            }else{
                                numCode = ('' + numCode);
                            }
                        }else{
                            numCode = ('' + numCode);
                        }
                        obj.numArr.push(numCode);
                    }
                });

                if (obj.playTypeID == '2071' || obj.playTypeID == '2061') { //单选包串、单选包胆
                    var c1 = parseInt(obj.numArr[0]);
                    obj.numArr = obj.numArr.slice(1, (1 + c1));
                    obj.numR1Txt = obj.numArr.join('+');
                }
                if (obj.playTypeID == '2617') { //猜大小
                    var c1 = parseInt(obj.numArr[0]);
                    var str = 　'';
                    if (c1 == '02') {
                        obj.numArr[0] = '大'
                    } else {
                        obj.numArr[0] = '小'
                    }
                }
                if (obj.playTypeID == '2618') { //猜奇偶
                    var c1 = parseInt(obj.numArr[0]);
                    var str = 　'';
                    if (c1 % 2 == 0) {
                        obj.numArr[0] = '偶'
                    } else {
                        obj.numArr[0] = '奇'
                    }
                }
                if (obj.playTypeID == '2111' || obj.playTypeID == '2110') { //组选胆拖
                    var c1 = parseInt(obj.numArr[0]);
                    obj.numArrR1 = obj.numArr.slice(1, (1 + c1));
                    obj.numArrB1 = obj.numArr.slice(1 + c1);
                    c1 = parseInt(obj.numArrB1[0]);
                    obj.numArrB1 = obj.numArrB1.slice(1, (1 + c1));
                }
            });
            if(play.length === 1){//说明此种彩票中的所有玩法一样，反之不一样
                lotteryData.gameType = true;
            }else{
                lotteryData.gameType = false;
            }
    if(lotteryData.prizeStat == 11 || lotteryData.prizeStat == 12){//未中奖和已中奖状态可查询中奖信息
        getWinNumberFn(lotteryData.province, lotteryData.platform, lotteryData.gameId, lotteryData.issue, lotteryData.featureCode);
    }
    var dataListTemplate = doT.template(document.getElementById('listTemplate').innerHTML);
    document.getElementById('lotteryCode').innerHTML = dataListTemplate(lotteryData);
    document.querySelector('.lottery_limit').innerText = 
    	'恭喜您获得' + (lotteryData.reward || '00') + '3D积分，您今日的双色球扫票次数还剩' + (lotteryData.limit || '00') + '次!';
}
//dom事件绑定
function domEventFn(){
	var $box = $('.slid_btn_box'),
		$down = $box.find('.xlld-down');
	$box.on('click', function(e){
		var $me = $(this),
			box = $me.find('.xlld-down'),
			h = box[0].scrollHeight;
		if($me.hasClass('active')){
			$me.removeClass('active');
			box.css({
				'height': '0'
			});
		}else{
			$me.addClass('active');
			box.css({
				'height': h + 'px'
			});
		}
	});
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
}

//刷新之后执行函数
function refreshAfterFn(){
	//说明页面所有请求都已经完成
	if(globalData.refreshComplete >= globalData.requestNum){
		globalData.refreshComplete = 0;//用来记录请求完成次数，记录归零
		globalData.requestNum = 0;//用来记录有多少次用户请求，记录归零
		if(globalData.isRefresh == true){
			globalData.isRefresh = false;
			Common.toast('刷新成功');
		}
	}
}


//获取开奖信息
function getWinNumberFn(province, platform, game, issue, lotteryCode){
    var _url = '/ushop-api-merchant/api/caipiao/hotline/ticket/draw/get/' + province + '/' + platform + '/' + game + '/' + issue + '/' + lotteryCode;
    Common.ajax(_url, 'post', {}, function(data){
        if(data.gameId){
            var numArr = JSON.parse(data.numbers),
                drawNumbers = document.getElementById('drawNumbers'),
                winNum;
            data.numArr1 = [];
            Common.each(numArr, function(index, obj){
                winNum = parseInt(obj.winNum);
                data.numArr1[(parseInt(obj.numSN) - 1)] = ((winNum < 10) ? ('0' + winNum) : ('' + winNum));
            });
            var str =
                    '<div>第 <span class="color-ff5534">' + data.issue + '</span> 期</div>'+
                    '<div style="height: .6em;"></div>'+
                    '<div class="xlld-p4 clearfix">'+
                        '<span>' + data.numArr1[0] + '</span>'+
                        '<span>' + data.numArr1[1] + '</span>'+
                        '<span>' + data.numArr1[2] + '</span>'+
                        '<span>' + data.numArr1[3] + '</span>'+
                        '<span>' + data.numArr1[4] + '</span>'+
                        '<span>' + data.numArr1[5] + '</span>'+
                        '<span class="blue">' + data.numArr1[6] + '</span>'+
                    '</div>'+
                    '<span class="icon icon-forward"></span>';
            drawNumbers.innerHTML = str;
            drawNumbers.classList.remove('hidden');
        }
    });
}

</script>
</body>
</html>
