<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>开奖公告</title>
<link rel="stylesheet" type="text/css" href="../../css/style.css?v=20180131"/>
<style>
.xl-ul {
	list-style: none;
	padding: 0;
	margin: 0;
	background: #fff;
}
.xl-ul .xl-li {
	position: relative;
	border-top: solid 1px #eee;
	padding: 10px 15px;
	font-size: 14px;
}
.xl-ul .xl-li:first-child {
	border-top: 0;
}
.xl-ul .xl-li.xl-arrows-r:after {
	font-family: Muiicons;
	font-weight: bold;
	content: '\e583';
	position: absolute;
	right: 15px;
	top: 50%;
	font-size: 24px;
	color: #aaa;
	-webkit-transform: translateY(-50%);
	transform: translateY(-50%);
}
.xl-ul .xl-li > img {
	position: absolute;
	left: 15px;
	top: 50px;
	width: 40px;
	height: 40px;
	-webkit-transform: translateY(-50%);
	transform: translateY(-50%);
}
.xl-ul .xl-li .xl-li-body {
	width: 100%;
	display: block;
	padding-left: 50px;
	min-height: 40px;
}
.xl-ul .xl-li.xl-arrows-r .xl-li-body {
	padding-right: 25px;
}
.xl-ul .xl-li {
	border-width: 2px;
}
.xlln-p1 {
	position: relative;
	font-size: 12px;
	padding-right: 100px;
	padding-bottom: 8px;
	margin-left: -50px;
}
.xlln-span1 {
	position: absolute;
	right: 0;
	top: 0;
	font-weight: normal;
	color: #999;
}
.xlln-p2 span {
	width: 26px;
	height: 26px;
	display: inline-block;
	border-radius: 50%;
	line-height: 22px;
	border: solid 2px #f00;
	color: #f00;
	text-align: center;
	margin: 0 2px;
}
.xlln-p2 span.xlln-last-span {
	border-color: #4a90e2;
	color: #4a90e2;
}
.xlln-box2 {
	top: 0;
	height: 100%;
	background: #f6f6f6;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">开奖公告</h1>
	</div>
</div>
<div class="xlbody-box">
	<div class="xlln-box1" id="lottery_detail">
		<ul class="xl-ul">
			<!--<li class="xl-li">
				<img src="../../image/icon/lottery_ssq.png"/>
				<div class="xl-li-body">
					<div class="xlln-p1 ellipsis">
						<strong>双色球</strong>
						（第20160202期）
						<strong class="xlln-span1">2016/01/01 21:21</strong>
					</div>
					<div class="xlln-p2">
						<span>05</span>
						<span>22</span>
						<span>14</span>
						<span>31</span>
						<span>02</span>
						<span>02</span>
						<span>06</span>
						<span class="xlln-last-span">5</span>
					</div>
				</div>
			</li>-->
		</ul>
	</div>
</div>
<div class="xlele-box xlln-box2" id="select_lottery_show">
	<div class="xlele-content">
		<ul class="xl-ul"></ul>
	</div>
</div>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script type="text/javascript">
"use strict";
var lottery_data = [
//		{value: 'pl3', text: '排列3', redMaxNo: 10, blueMaxNo: 0, noNum: 3, imgUrl: '../../image/icon/lottery_pailie3.png'},
//		{value: 'pl5', text: '排列5', redMaxNo: 10, blueMaxNo: 0, noNum: 5, imgUrl: '../../image/icon/lottery_pailie5.png'},
		{value: 'fc3d', text: '福彩3D', redMaxNo: 10, blueMaxNo: 0, noNum: 3, imgUrl: '../../image/icon/lottery_3d.png'},
//		{value: 'qxc', text: '七星彩', redMaxNo: 10, blueMaxNo: 0, noNum: 7, imgUrl: '../../image/icon/lottery_qixingcai.png'},
		{value: 'qlc', text: '七乐彩', redMaxNo: 30, blueMaxNo: 0, noNum: 7, imgUrl: '../../image/icon/lottery_7lecai.png'},
		{value: 'ssq', text: '双色球', redMaxNo: 33, blueMaxNo: 16, noNum: 3, imgUrl: '../../image/icon/lottery_ssq.png'}
//		{value: 'dlt', text: '大乐透', redMaxNo: 35, blueMaxNo: 12, noNum: 7, imgUrl: '../../image/icon/lottery_daletou.png'}
	];
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});


//页面启动时，数据初始化
function pageDataInit(){
}
//dom事件绑定
function domEventFn(){
	$(window).on('hashchange', function(){
		if(location.hash === '#lottery_detail'){
			$('#select_lottery_show').hide();
		}else{
			$('#select_lottery_show').show();
		}
	});
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
	getLotteryData();
}
//刷新之后执行函数
function refreshAfterFn(){
	//说明页面所有请求都已经完成
	if(globalData.refreshComplete >= globalData.requestNum){
		globalData.refreshComplete = 0;//用来记录请求完成次数，记录归零
		globalData.requestNum = 0;//用来记录有多少次用户请求，记录归零
		if(globalData.isRefresh == true){
			globalData.isRefresh = false;
			Common.toast('刷新成功');
		}
	}
}

//获取彩票数据
function getLotteryData(){
	var localLot = Common.localLotL();
	if(
		(lottery_data.length === (localLot.lotteryData && localLot.lotteryData.length))&&
		localLot.timestamp&&
		(((+new Date()) - localLot.timestamp < 86400000))
	){
		lottery_data = localLot.lotteryData;
		lotteryDataAfter();
		return false;
	}
	var redBlue, _url, timestamp;
	Common.each(lottery_data, function(index, obj){
		_url = 'http://f.apiplus.cn/' + obj.value + '-50.json';
		Common.ajax({
			url: _url,
			dataType: 'jsonp'
		}, function(data){
			if(data.code){
				Common.each(data.data, function(i, o){
					redBlue = o.opencode.split('+');
					o.codeArrRed = redBlue[0].split(',');
					if(redBlue[1]){
						o.codeArrBlue = redBlue[1].split(',');
					}
				});
				obj.lotteryData = data;
			}else{
				obj.lotteryData = {};
			}
			if(lottery_data.every(function(o, i){return o.lotteryData;})){
				timestamp = 0;
				if(lottery_data.every(function(o, i){return o.lotteryData.code;})){
					timestamp = +new Date();
				}
				Common.localLotL({lotteryData: lottery_data, timestamp: timestamp});
				lotteryDataAfter();
			}
		});
	});
}

//获取彩票数据之后
function lotteryDataAfter(){
	var str = '';
	Common.each(lottery_data, function(i, o){
		str += formatDataFn(o, 1);
	});
	$('#select_lottery_show').find('ul').html(str);
}

//格式化数为HTML字符串
function formatDataFn(data, num){
	var str = '', p = '';
	Common.each(data.lotteryData.data, function(index, obj){
		if(index >= num){return false;};
		p = '';
		Common.each(obj.codeArrRed, function(i, n){
			p += '<span>' + n + '</span>';
		});
		Common.each(obj.codeArrBlue, function(i, n){
			p += '<span class="xlln-last-span">' + n + '</span>';
		});
		str += 
			'<li class="xl-li" onclick="showLotteryDetail(\'' + data.value + '\')">'+
				'<img src="' + data.imgUrl + '"/>'+
				'<div class="xl-li-body">'+
					'<div class="xlln-p1 ellipsis">'+
						'<strong>' + data.text + '</strong>'+
						'（第' + obj.expect + '期）'+
						'<strong class="xlln-span1">2016/01/01 21:21</strong>'+
					'</div>'+
					'<div class="xlln-p2">'+
						p+
					'</div>'+
				'</div>'+
			'</li>';
	});
	return str;
}

//显示相应的彩票公告详情
function showLotteryDetail(code){
	Common.each(lottery_data, function(index, obj){
		if(obj.value === code){
			var str = formatDataFn(obj);
			location.hash = '#lottery_detail';
			$('#select_lottery_show').hide();
			$('#lottery_detail').find('ul').html(str);
			return false;
		}
	});
}
</script>
</body>
</html>