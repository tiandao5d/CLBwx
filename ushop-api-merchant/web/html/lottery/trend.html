<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>开奖走势</title>
<link rel="stylesheet" type="text/css" href="../../css/style.css?v=20180131"/>
<style>
/*号码走势样式开始*/
.xl-tab-fixed {
	top: 0;
}
.xl-tab-title {
	line-height: 2.6em;
	text-align: center;
	font-weight: 500;
}
.xl-tab-title .xl-tab-hitem {
	float: left;
	width: 33.33333%;
	color: #333;
}
.xl-tab-title .xl-tab-hitem.active {
	color: #ff5534;
}
.xlele-box.xl-tab-content {
	top: 2.6em;
	width: auto;
	bottom: 0;
	right: 0;
}
.xlele-box.xl-tab-content .xlele-content {
	height: 100%;
}
.xl-tab-citem {
    position: relative;
    width: 100%;
    height: 100%;
	display: none;
}
.xl-tab-citem.active {
	display: block;
}
.xlnm-table-box {
	position: absolute;
	left: 0;
	top: 0;
	right: 0;
	bottom: 0;
	overflow: auto;
}
::-webkit-scrollbar {
	width: 0;
	height: 0;
}
.xlnm-row {
	float: left;
	width: auto;
	white-space: nowrap;
	min-width: 100%;
}
.xlnm-row:nth-child(2n+1) {
	background: #fff7e9;
}
.xlnm-cell {
	display: inline-block;
	width: 26px;
	height: 100%;
	text-align: center;
	line-height: 26px;
	margin: 4px;
	color: #555;
	position: relative;
}
.xlnm-cell.xlnm-bg-ff5534 {
	background: #ff5534;
	border-radius: 50%;
	color: #fff;
}
.xlnm-cell:before {
	content: '';
	position: absolute;
	width: 1px;
	background: #ccc;
	left: -6px;
	top: -4px;
	bottom: -4px;
}
.xlnm-cell:first-child {
	width: 40px;
}
.xlnm-head-lh {
	background: #ffe8c2;
}
.col-xs-3 {
	float: left;
	width: 25%;
}
.xlnm-head-lh .col-xs-3 {
	height: 42px;
	text-align: center;
	line-height: 42px;
	border-left: solid 1px #aaa;
}
.xlnm-head-lh .xlnm-lh-order {
	padding-right: 21px;
}
.xlnm-head-lh .xlnm-lh-span {
	position: absolute;
	right: 3px;
	width: 18px;
	height: 10px;
}
.xlnm-table-lh {
	position: absolute;
	top: 42px;
	bottom: 0;
	left: 0;
	right: 0;
	overflow-y: scroll;
}
.xlnm-table-lh::-webkit-scrollbar {
	width: 0;
	height: 0;
}
.xlnm-row-lh .col-xs-3 {
	border-left: solid 1px #aaa;
}
.xlnm-head-lh .col-xs-3:first-child,
.xlnm-row-lh .col-xs-3:first-child {
	border-width: 0;
}
.xlnm-row-lh:nth-child(2n){
	background: #fff7e9;
}
.xlnm-row-lh .col-xs-3 span {
	height: 30px;
	width: 30px;
	display: block;
	margin: 5px auto;
	text-align: center;
	line-height: 30px;
}
.xlnm-cell-bg .col-xs-3:first-child span {
	border-radius: 50%;
	color: #fff;
	background: #ff5534;
}
.xlnm-width-cell .col-xs-3 span {
	width: auto;
}
.xlnm-table-trend {
	background: #fff;
	min-width: 100%;
}
.xlnm-table-trend tr:nth-child(2n+1) {
	background: #fff7e9;
}
.xlnm-table-trend td {
	text-align: center;
	vertical-align: middle;
	border-right: solid 1px #ccc;
}
.xlnm-table-trend td span {
	display: inline-block;
	vertical-align: top;
	width: 26px;
	height: 26px;
	text-align: center;
	line-height: 26px;
	margin: 3px;
	border-radius: 50%;
}
.xlnm-table-trend td:first-child {
	border-right: 0;
}
.xlnm-table-trend td:first-child span {
	width: 5em;
}
.xlnm-tbox,
.xlnm-lbox,
.xlnm-cbox {
	position: absolute;
	left: 0;
	top: 0;
	overflow: hidden;
}
.xlnm-tbox {
	right: 0;
	border-bottom: solid 1px #ccc;
}
.xlnm-lbox {
	bottom: 0;
}
.xlnm-cbox {
	z-index: 10;
	background: #fff7e9;
	border-bottom: solid 1px #ccc;
}
.xlnm-lbox,
.xlnm-cbox {
	border-right: solid 1px #ccc;
}
.xlnm-table-trend td {
	overflow: hidden;
	border: 0;
	border-right: solid 1px #ccc;
}
.xlnm-table-trend td:first-child {
	border: 0;
}
.xlnm-table-trend td:last-child {
	border: 0;
}
.xlnm-table-trend td span.codeNotShow {
	color: #888;
}
.xlnm-table-trend td span.codeShow {
	background: #ff5534;
	color: #fff;
}
.xlnm-table-trend td span.codeBlueShow {
	background: #4a90e2;
	color: #fff;
}

/*彩票选择界面*/
.select-lottery {
	top: 0;
	height: 100%;
	background: #f6f6f6;
	display: none;
}
.select-lottery.active {
	display: block;
}
.xlmenu-box,
.select-lottery .xlele-content {
	background: none;
}
.xlmenu-box .xlmenu-item {
	background: #fff;
	width: 50%;
	border-right: 1px solid #eee;
    border-bottom: 1px solid #eee;
}
.xlmenu-box .xlmenu-item > a {
	padding: 2em 1em;
}
.xlmenu-box .xl9g-img {
	width: 50px;
	height: 50px;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">开奖走势</h1>
	</div>
</div>
<div class="xlele-box">
	<div class="xlele-content xl-tab-fixed">
		<div class="xl-tab-title clearfix" id="tab_head">
			<a class="xl-tab-hitem" _hash="#tab_item1" onclick="tabCutFn('#tab_item1')">基本走势</a>
			<a class="xl-tab-hitem" _hash="#tab_item2" onclick="tabCutFn('#tab_item2')">冷热分析</a>
			<a class="xl-tab-hitem" _hash="#tab_item3" onclick="tabCutFn('#tab_item3')">形态对比</a>
		</div>
	</div>
</div>
<div class="xlele-box xl-tab-content">
	<div class="xlele-content">
			<div class="xl-tab-citem tab_item" id="tab_item1">
				<div class="xlnm-table-box" id="ISwrapper">
					<table class="xlnm-table-trend"></table>
				</div>
			</div>
			<div class="xl-tab-citem tab_item" id="tab_item2">
				<div class="xlnm-head-lh clearfix">
					<div class="col-xs-3 xlnm-lh-order">红球</div>
					<div class="col-xs-3 xlnm-lh-order">10期</div>
					<div class="col-xs-3 xlnm-lh-order">15期</div>
					<div class="col-xs-3 xlnm-lh-order">20期</div>
				</div>
				<div class="xlnm-table-lh xlnm-cell-bg xlnm-lrfxBox"></div>
			</div>
			<div class="xl-tab-citem tab_item" id="tab_item3">
				<div class="xlnm-head-lh clearfix">
					<div class="col-xs-3 xlnm-lh-order">期号</div>
					<div class="col-xs-3">大小比</div>
					<div class="col-xs-3">奇偶比</div>
					<div class="col-xs-3">质合比</div>
				</div>
				<div class="xlnm-table-lh xlnm-width-cell xlnm-xtdbBox"></div>
			</div>
	</div>
</div>
<div class="xlele-box select-lottery active" id="select_lottery">
	<div class="xlele-content">
		<div class="select_box"></div>
	</div>
</div>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/iscroll-probe.min.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>

<script type="text/javascript">
"use strict";
//选择哪种彩票的走势
var myScroll1,
	lottery_data = [
//		{value: 'pl3', text: '排列3', redMaxNo: 10, blueMaxNo: 0, noNum: 3, imgUrl: '../../image/icon/lottery_pailie3.png'},
//		{value: 'pl5', text: '排列5', redMaxNo: 10, blueMaxNo: 0, noNum: 5, imgUrl: '../../image/icon/lottery_pailie5.png'},
		{value: 'fc3d', text: '福彩3D', redMaxNo: 10, blueMaxNo: 0, noNum: 3, imgUrl: '../../image/icon/lottery_3d.png'},
//		{value: 'qxc', text: '七星彩', redMaxNo: 10, blueMaxNo: 0, noNum: 7, imgUrl: '../../image/icon/lottery_qixingcai.png'},
		{value: 'qlc', text: '七乐彩', redMaxNo: 30, blueMaxNo: 0, noNum: 7, imgUrl: '../../image/icon/lottery_7lecai.png'},
		{value: 'ssq', text: '双色球', redMaxNo: 33, blueMaxNo: 16, noNum: 3, imgUrl: '../../image/icon/lottery_ssq.png'}
//		{value: 'dlt', text: '大乐透', redMaxNo: 35, blueMaxNo: 12, noNum: 7, imgUrl: '../../image/icon/lottery_daletou.png'}
	];
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});


//页面启动时，数据初始化
function pageDataInit(){
//	hashChangeFn();
}
//dom事件绑定
function domEventFn(){
	$(window).on('hashchange', function(){
		hashChangeFn();
	}).on('resize', function(){
	if(!$('#select_lottery').hasClass('active')){
		selectLotteryFn(globalData.showCode, false);
	}
})
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
	getLotteryData();//获取彩票数据
}
//刷新之后执行函数
function refreshAfterFn(){
	//说明页面所有请求都已经完成
	if(globalData.refreshComplete >= globalData.requestNum){
		globalData.refreshComplete = 0;//用来记录请求完成次数，记录归零
		globalData.requestNum = 0;//用来记录有多少次用户请求，记录归零
		if(globalData.isRefresh == true){
			globalData.isRefresh = false;
			Common.toast('刷新成功');
		}
	}
}

//tab的切换
function tabCutFn(_hash){
	$('.tab_item').removeClass('active');
	$(_hash).addClass('active');
	$('#tab_head').find('a').removeClass('active');
	$('[_hash="' + _hash + '"]').addClass('active');
	$('#select_lottery').removeClass('active');
}

//哈希变化
function hashChangeFn(){
	if(location.hash === '#tabShow'){
		$('#select_lottery').removeClass('active');
	}else{
		$('#select_lottery').addClass('active');
	}
}
//获取彩票数据
function getLotteryData(){
	var localLot = Common.localLotL();
	if(
		(lottery_data.length === (localLot.lotteryData && localLot.lotteryData.length))&&
		localLot.timestamp&&
		(((+new Date()) - localLot.timestamp < 86400000))
	){
		lottery_data = localLot.lotteryData;
		lotteryDataAfter();
		return false;
	}
	var redBlue, _url;
	Common.each(lottery_data, function(index, obj){
		_url = 'http://f.apiplus.cn/' + obj.value + '-50.json';
		Common.ajax({
			url: _url,
			dataType: 'jsonp'
		}, function(data){
			if(data.code){
				Common.each(data.data, function(i, o){
					redBlue = o.opencode.split('+');
					o.codeArrRed = redBlue[0].split(',');
					if(redBlue[1]){
						o.codeArrBlue = redBlue[1].split(',');
					}
				});
				obj.lotteryData = data;
			}else{
				obj.lotteryData = {};
			}
			if(lottery_data.every(function(o, i){return o.lotteryData;})){
				var timestamp = 0;
				if(lottery_data.every(function(o, i){return o.lotteryData.code;})){
					timestamp = +new Date();
				}
				Common.localLotL({lotteryData: lottery_data, timestamp: timestamp});
				lotteryDataAfter();
			}
		});
	});
}
//选择彩票显示
function selectLotteryFn(code, isSe){
	if(!(isSe === false)){
		location.hash = '#tabShow';
		tabCutFn('#tab_item1');
	}
	globalData.showCode = code;
	var obj, re, rtest;
	Common.each(lottery_data, function(i, o){
		if(o.value === code){
			obj = o;
			rtest = o;
			return false;
		}
	});
	obj = JSON.parse(JSON.stringify(obj));
	re = obj.lotteryData;
	re.data.reverse();//倒序
	//基本走势数据呈现
	if(obj.value == 'qlc' || obj.value == 'ssq' || obj.value == 'dlt'){//有蓝色球的
		trendList(re.data, obj);
	}else{//没有蓝色球的
		trendListY(re.data, obj);
	}

	//冷热分析数据呈现
	lrfxShowData(re.data, obj);
	//形态对比数据呈现
	xtdbShowData(re.data, obj);
}

//彩票数据获取之后执行
function lotteryDataAfter(){
	var str = '';
	Common.each(lottery_data, function(index, obj){
		str += 
			'<div class="xlmenu-item">'+
				'<a onclick="selectLotteryFn(\'' + obj.value + '\')">'+
					'<div class="xl-badge-box">'+
						'<img  class="xl9g-img" src="' + obj.imgUrl + '">'+
					'</div>'+
					'<span class="xl9g-text">' + obj.text + '</span>'+
				'</a>'+
			'</div>';
	});
	str = '<div class="xlmenu-box clearfix">' + str + '</div>'
	$('#select_lottery').find('.select_box').html(str);
}

//形态对比数据呈现
function xtdbShowData(data, obj){
	var primeNo = [1,2,3,5,7,11,13,17,19,23,29,31],//质数
		compositeNo = [4,6,8,9,10,12,14,15,16,18,20,21,22,24,25,26,27,28,29,30,32,33];//合数
	var i = 0,
		j = 0,
		str = '',
		dxbd = [],
		dxbx = [],
		jobj = [],
		jobo = [],
		zhbz = [],
		zhbh = [],
		dataLgn = data.length,
		codeArr = [],
		codeArrLgn = 0;

	for(; j < dataLgn; j ++){
		dxbd = [];
		dxbx = [];
		jobj = [];
		jobo = [];
		zhbz = [];
		zhbh = [];
		codeArr = data[j].opencode.split(',');
		codeArrLgn = codeArr.length;
		for(i = 0; i < codeArrLgn; i++){
			if(parseInt(codeArr[i]) > 16){//大数
				dxbd.push(codeArr[i]);
			}else{//小数
				dxbx.push(codeArr[i]);
			}
			if(parseInt(codeArr[i]) % 2 > 0){//奇数
				jobj.push(codeArr[i]);
			}else{//偶数
				jobo.push(codeArr[i]);
			}
			if(primeNo.indexOf(parseInt(codeArr[i]))){//质数
				zhbz.push(codeArr[i]);
			}else{//合数
				zhbh.push(codeArr[i]);
			}
		}
		str +=  '<div class="clearfix xlnm-row-lh">'+
					'<div class="col-xs-3"><span>' + data[j].expect + '期</span></div>'+
					'<div class="col-xs-3"><span>' + dxbd.length + ' : ' + dxbx.length + '</span></div>'+
					'<div class="col-xs-3"><span>' + jobj.length + ' : ' + jobo.length + '</span></div>'+
					'<div class="col-xs-3"><span>' + zhbz.length + ' : ' + zhbh.length + '</span></div>'+
				'</div>'

	}
	document.querySelector('.xlnm-xtdbBox').innerHTML = str;

}
function lrfxShowData(data, obj){
	var i = 0,
		j = 0,
		lgn = data.length,
		str = '',
		num20 = 0,
		num50 = 0,
		num100 = 0,
		arr = [];
	for(; i < obj.redMaxNo; i++){
		num20 = 0;
		num50 = 0;
		num100 = 0;
		for(j = 0; j < 10; j++){
			if(data[j].opencode.indexOf('+')){
				arr = data[j].opencode.split('+')[0].split(',')
			}else{
				arr = data[j].opencode.split(',');
			}

			if(arr.some(function(sv, si){return (parseInt(sv) == parseInt(i))})){
				num20 += 1;
			}
		}
		for(j = 0; j < 15; j++){
			if(data[j].opencode.indexOf('+')){
				arr = data[j].opencode.split('+')[0].split(',')
			}else{
				arr = data[j].opencode.split(',');
			}
			if(arr.some(function(sv, si){return (parseInt(sv) == parseInt(i))})){
				num50 += 1;
			}
		}
		for(j = 0; j < 20; j++){
			if(data[j].opencode.indexOf('+')){
				arr = data[j].opencode.split('+')[0].split(',')
			}else{
				arr = data[j].opencode.split(',');
			}
			if(arr.some(function(sv, si){return (parseInt(sv) == parseInt(i))})){
				num100 += 1;
			}
		}
		str +=
			'<div class="clearfix xlnm-row-lh">'+
				'<div class="col-xs-3"><span>' + ((obj.redMaxNo > 10) ? ((i + 1) < 10 ? '0' + (i + 1) : (i + 1) + '') : i) + '</span></div>'+
				'<div class="col-xs-3"><span>' + num20 + '</span></div>'+
				'<div class="col-xs-3"><span>' + num50 + '</span></div>'+
				'<div class="col-xs-3"><span>' + num100 + '</span></div>'+
			'</div>'
	}
	document.querySelector('.xlnm-lrfxBox').innerHTML = str;
};


//号码走势号码列表页面呈现
function trendListY(data, obj){
	var i = 0, j = 0, k = 0, r = 0, str = '', strs = '', hstr = '', hstrs = '',
		opencode, redBlue, codeArrRed, codeArrBlue,
		dataLgn = data.length,
		codeLgn = data[0].opencode.split(',').length;
	for(; i < dataLgn; i++){
		opencode = data[i].opencode.split(',');
		k = 0;
		strs = '';
		hstrs = '';
		for(; k < obj.noNum; k++){
			r = 0;
			for(; r < 10; r++){
				if(parseInt(opencode[k]) == r){
					strs += '<td><span class="codeShow">' + r + '</span></td>';
				}else{
					strs += '<td><span class="codeNotShow"> </span></td>';
				}
				hstrs += '<td><span>' + r + '</span></td>'
			}
		}

		str += 	'<tr>'+
					'<td><span>' + data[i].expect + '</span></td>'+
					strs+
				'</tr>';


		hstr =  '<tr>'+
					'<td><span></span></td>'+
					hstrs+
				'</tr>';
	}
	document.querySelector('.xlnm-table-trend').innerHTML = hstr + str;
	scrollFixed(document.querySelector('.xlnm-table-trend'));
}

//号码走势号码列表页面呈现
function trendList(data, obj){
	var i = 0, j = 0, k = 0, r = 0, str = '', strs = '', hstr = '', hstrs = '', className = '',
		opencode, redBlue, codeArrRed, codeArrBlue,
		dataLgn = data.length,
		codeLgn = data[0].opencode.split(',').length;

	for(; i < dataLgn; i++){

		redBlue = data[i].opencode.split('+');
		codeArrRed = redBlue[0].split(',');
		if(redBlue[1]){
			codeArrBlue = redBlue[1].split(',');
		}else{
			codeArrBlue = [];
		}
		opencode = codeArrRed.concat(codeArrBlue);

		k = 0;
		strs = '';
		for(; k < obj.redMaxNo; k++){
			r = (k + 1) < 10 ? '0' + (k + 1) : (k + 1) + '';
			if(opencode.indexOf(r) >= 0){
				className = '';
				if(codeArrBlue.indexOf(r) >= 0){
					className += 'codeBlueShow ';
				}
				if(codeArrRed.indexOf(r) >= 0){
					className += 'codeShow ';
				}
				strs += '<td><span class="' + className + '">' + r + '</span></td>';
			}else{
				strs += '<td><span class="codeNotShow"> </span></td>';
			}
		}

		str += 	'<tr>'+
					'<td><span>' + data[i].expect + '</span></td>'+
					strs+
				'</tr>';
	}
	for(; j < obj.redMaxNo; j++){
		hstrs += '<td><span>' + ((j + 1) < 10 ? '0' + (j + 1) : (j + 1)) + '</span></td>'
	}
	hstr =  '<tr>'+
				'<td><span></span></td>'+
				hstrs+
			'</tr>';
	document.querySelector('.xlnm-table-trend').innerHTML = hstr + str;
	scrollFixed(document.querySelector('.xlnm-table-trend'));
}


//号码走势悬浮的表头和期号
function scrollFixed(table){

	$('.xlnm-boxShare').each(function(){
		this.parentNode.removeChild(this);
	});

	var tparent = table.parentNode,
		tr = table.querySelectorAll('tr'),
		lgn = tr.length,
		i = 0,
		tbox = document.createElement('div'),
		lbox = document.createElement('div'),
		cbox = document.createElement('div'),
		ttable = table.cloneNode(),
		ltable = table.cloneNode(),
		ctable = table.cloneNode(),
		ltr;
	myScroll1 = null;

	for(; i < lgn; i++){
		ltable.appendChild(tr[i].cloneNode()).appendChild(tr[i].querySelector('td').cloneNode(true));
	}
	ttable.appendChild(tr[0].cloneNode(true));
	ttable.appendChild(tr[1].cloneNode(true));
	tbox.style.height = tr[0].offsetHeight + 'px';
	lbox.style.width = tr[0].querySelector('td').offsetWidth + 'px';
	cbox.style.width = tr[0].querySelector('td').offsetWidth + 'px';
	cbox.style.height = tr[0].querySelector('td').offsetHeight + 'px';

	tbox.classList.add('xlnm-tbox');
	lbox.classList.add('xlnm-lbox');
	cbox.classList.add('xlnm-cbox');
	tbox.classList.add('xlnm-boxShare');
	lbox.classList.add('xlnm-boxShare');
	cbox.classList.add('xlnm-boxShare');
	tbox.appendChild(ttable);
	lbox.appendChild(ltable);
	ctable.appendChild(lbox.querySelector('tr').cloneNode(true))
	tparent.parentNode.appendChild(tbox);
	tparent.parentNode.appendChild(lbox);
	tparent.parentNode.appendChild(cbox);

	myScroll1 = new IScroll("#ISwrapper", {
	    // preventDefault:false,
	    probeType: 3, //需要使用 iscroll-probe.js 才能生效 probeType ： 1 滚动不繁忙的时候触发 probeType ： 2 滚动时每隔一定时间触发 probeType ： 3   每滚动一像素触发一次
	    mouseWheel: true, //是否监听鼠标滚轮事件。
	    scrollX: true,
	    scrollY: true,
	    // momentum: false,
	    snap: false, //自动分割容器，用于制作走马灯效果等。Options.snap:true// 根据容器尺寸自动分割
	    //snapSpeed: 400,
	    scrollbars: false, //是否显示默认滚动条
	    freeScroll: false, //主要在上下左右滚动都生效时使用，可以向任意方向滚动。
	    deceleration: 0.0006, //滚动动量减速越大越快，建议不大于 0.01,默认:0.0006
	    disableMouse: true, //是否关闭鼠标事件探测。如知道运行在哪个平台，可以开启它来加速。
	    disablePointer: true, //是否关闭指针事件探测。如知道运行在哪个平台，可以开启它来加速。
	    disableTouch: false, //是否关闭触摸事件探测。如知道运行在哪个平台，可以开启它来加速。
	    eventPassthrough: false, //使用 IScroll 的横轴滚动时，如想使用系统立轴滚动并在横轴上生效，请开启。
	    bounce: false //是否启用弹力动画效果，关掉可以加速
	});
	myScroll1.on('scroll', updatePosition);
	myScroll1.on('scrollEnd', updatePosition);

	function updatePosition(){
		ttable.style.transform = 'translate(' + this.x + 'px, 0px)';
		ltable.style.transform = 'translate(0px, ' + this.y + 'px)';
	}

}

</script>
</body>
</html>
