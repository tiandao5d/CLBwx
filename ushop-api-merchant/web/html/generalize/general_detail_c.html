<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>推广明细</title>
<link rel="stylesheet" href="../../css/style.css?v=20180131"/>
<style>
.xlgd-box1 {
	background: #fff;
	text-align: center;
	font-size: 1.1em;
	padding-top: 10px;
}
.xlgd-box2 {
	position: relative;
	background: #fff;
	padding: 10px 15px;
}
.xlgd-l1,
.xlgd-r1 {
	width: 50%;
	float: left;
	line-height: 1.6em;
	font-size: .8em;
	background: url(../../image/img/general_icon003.png) 1em center no-repeat;
	background-size: 2.4em;
	padding-left: 4em;
}
.xlgd-r1 {
	background: url(../../image/img/general_icon002.png) 1em center no-repeat;
	background-size: 2.4em;
}
.xlgd-slide {
	width: 1px;
	background: #ccc;
	position: absolute;
	left: 50%;
	top: 10px;
	bottom: 10px;
}
.xltab-call {
	float: left;
	width: 33.333%;
	text-align: center;
	text-overflow: ellipsis;
	overflow: hidden;
	background: #fff;
	white-space: nowrap;
	line-height: 2em;
}
.xltab-title {
	background: #fff;
	text-align: center;
}
.xltab-title a {
	float: left;
	width: 50%;
	line-height: 2em;
	font-size: 1.2em;
	border-bottom: solid 3px #fff;
	color: #333;
}
.xltab-title a.active {
	border-bottom-color: #ff8719;
}
.xltab-tr .xltab-call {
	color: #888;
}
.xltab-head,
.xltab-item {
	display: none;
}
.xltab-head.active,
.xltab-item.active {
	display: block;
}
.xltab-head {
	position: static;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">推广明细</h1>
	</div>
</div>
<div class="xlbody-box">
	<div id="userGenerInfo">
		<div class="xlgd-box1">当前累计发展好友00人，总收入00彩豆</div>
		<div class="xlgd-box2 clearfix">
			<div class="xlgd-l1">
				<div class="xlgd-p1 text-ellipsis">好友人数：00</div>
				<div class="xlgd-p1 text-ellipsis">累计收入：00彩豆</div>
			</div>
			<div class="xlgd-slide"></div>
			<div class="xlgd-r1">
				<div class="xlgd-p1 text-ellipsis">好友人数：00</div>
				<div class="xlgd-p1 text-ellipsis">累计收入：00彩豆</div>
			</div>
		</div>
	</div>
	<div style="height: 8px;"></div>
	<div class="xltab-title clearfix">
		<a datahref="contentItem1" class="xltabtitem" onclick="onTapTabTitel(this)">收入明细</a>
		<a datahref="contentItem2" class="xltabtitem" onclick="onTapTabTitel(this)">好友明细</a>
	</div>
	<div style="height: 3px;"></div>
	<div class="xltab-head xltabcitem contentItem1 clearfix">
		<div class="xltab-call">昵称</div>
		<div class="xltab-call">绑定时间</div>
		<div class="xltab-call">总提成（彩豆）</div>
	</div>
	<div class="xltab-head xltabcitem contentItem2 clearfix">
		<div class="xltab-call">昵称</div>
		<div class="xltab-call">时间</div>
		<div class="xltab-call">提成（彩豆）</div>
	</div>
	<div class="xltab-content">
		<div class="xltab-item xltabcitem contentItem1" id="contentItem1"></div>
		<div class="xltab-item xltabcitem contentItem2" id="contentItem2"></div>
	</div>
</div>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/md5.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script>
"use strict";
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});
//页面启动时，数据初始化
function pageDataInit(){
	Common.generalL(function(userGenerInfo){
		if(userGenerInfo){
			var str =
					'<div class="xlgd-box1">当前累计发展好友' + (parseInt(userGenerInfo.subordinate) + parseInt(userGenerInfo.secondary)) + '人，'+
					'总收入' + (parseInt(userGenerInfo.rebates) + parseInt(userGenerInfo.rewards)) + '彩豆</div>'+
					'<div class="xlgd-box2 clearfix">'+
						'<div class="xlgd-l1">'+
							'<div class="xlgd-p1 text-ellipsis">好友人数：' + userGenerInfo.subordinate + '</div>'+
							'<div class="xlgd-p1 text-ellipsis">累计收入：' + userGenerInfo.rebates + '彩豆</div>'+
						'</div>'+
						'<div class="xlgd-slide"></div>'+
						'<div class="xlgd-r1">'+
							'<div class="xlgd-p1 text-ellipsis">好友人数：' + userGenerInfo.secondary + '</div>'+
							'<div class="xlgd-p1 text-ellipsis">累计收入：' + userGenerInfo.rewards + '彩豆</div>'+
						'</div>'+
					'</div>';
			document.getElementById('userGenerInfo').innerHTML = str;
		}else {
			Common.toast('数据错误！');
		}
	});
}
//dom事件绑定
function domEventFn(){
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
	var datahref = globalData.pageParam.showItem || 'contentItem1';
	onTapTabTitel(document.querySelector('[datahref="' + datahref + '"]'));
}

//刷新之后执行函数
function refreshAfterFn(){
	//说明页面所有请求都已经完成
	if(globalData.refreshComplete >= globalData.requestNum){
		globalData.refreshComplete = 0;//用来记录请求完成次数，记录归零
		globalData.requestNum = 0;//用来记录有多少次用户请求，记录归零
		if(globalData.isRefresh == true){
			globalData.isRefresh = false;
			Common.toast('刷新成功');
		}
	}
}

//抬头点击事件
function onTapTabTitel(me){
	var datahref = me.getAttribute('datahref'),
		curItem = document.getElementById(datahref),
		oldTime = parseInt(curItem.getAttribute('oldTime')),
		newTime = parseInt((new Date()).getTime());
	Common.each(document.querySelectorAll('.xltabtitem'), function(){
		this.classList.remove('active');
	});
	Common.each(document.querySelectorAll('.xltabcitem'), function(){
		this.classList.remove('active');
	});
	Common.each(document.querySelectorAll('.' + datahref), function(){
		this.classList.add('active');
	});
	me.classList.add('active');
	if((newTime - oldTime) < 300000){//延迟请求
		return false;
	}
	if(datahref == 'contentItem1'){//收支明细
		incomeListFn(datahref);
	}else if(datahref == 'contentItem2'){//好友明细
		friendListFn(datahref);
	}
}



//我的下家列表请求
function friendListFn(datahref){
	var curItem = document.getElementById(datahref);
	var _url = '/ushop-api-merchant/api/user/promotion/subordinater/list/1';
	Common.ajax(_url, 'get', {}, function(data){
    	if(data.recordList){
			curItem.setAttribute('oldTime', (new Date()).getTime());
    		var str = '';
    		Common.each(data.recordList, function(index, obj){
    			str +=
						'<div class="xltab-tr clearfix">'+
							'<div class="xltab-call">' + obj.userName + '</div>'+
							'<div class="xltab-call">' + Common.msToTime(obj.createTime).es + '</div>'+
							'<div class="xltab-call">' + obj.rebates + '</div>'+
						'</div>';
    		});
    		curItem.innerHTML = str || '<div style="text-align: center; line-height: 3em; color: #888;">没有数据</div>';
    	}else{
    		Common.toast('未请求到数据！');
    	}
	});
}

//我的收入列表请求
function incomeListFn(datahref){
	var curItem = document.getElementById(datahref);
	var _url = '/ushop-api-merchant/api/user/promotion/welfare/list';
	Common.ajax(_url, 'get', {}, function(data){
    	if(data.recordList){
			curItem.setAttribute('oldTime', (new Date()).getTime());
    		var str = '';
    		Common.each(data.recordList, function(index, obj){
    			str +=
						'<div class="xltab-tr clearfix">'+
							'<div class="xltab-call">' + obj.userName + '</div>'+
							'<div class="xltab-call">' + Common.msToTime(obj.createTime).es + '</div>'+
							'<div class="xltab-call">' + obj.rebates + '</div>'+
						'</div>';
    		});
    		curItem.innerHTML = str || '<div style="text-align: center; line-height: 3em; color: #888;">没有数据</div>';
    	}else{
    		Common.toast('未请求到数据！');
    	}
	});
}


</script>
</body>
</html>
