<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>晒单</title>
<link rel="stylesheet" type="text/css" href="../../css/style.css?v=20180131"/>
<style>
.xlsf-p1 {
	position: relative;
}
.xlsf-p1 img {
	width: 100%;
}
.xlsf-p2 {
	background: #fff;
	padding: .5em .8em;
}
.xlsf-p2 .xlsf-s1 {
	line-height: 2em;
}
.xlsf-p2 textarea {
	border: solid 1px #333;
	border-radius: .3em;
	resize: none;
	width: 100%;
	height: 8em;
	padding: .5em;
}

.xlsf-p3 {
	background: #fff;
	padding: .5em .8em;
	text-align: center;
}
.xlsf-s2 {
	display: inline-block;
}
.xlsf-s2 img {
	float: left;
	width: 5em;
	margin-left: 1em;
}
.xlsf-s2 img:first-child {
	margin-left: 0;
}
.xlsf-s3 {
	color: #888;
	line-height: 2em;
}

.xlbs-score {
	background: #fff;
	padding: 0 .8em .5em;
	color: #777;
}
.xlbs-score h3 {
	font-size: 1.2em;
	color: #333;
	font-weight: normal;
}
.xlbs-score-row {
	padding-bottom: .5em;
}
 .xlbs-score-tt {
 	vertical-align: middle;
 	display: inline-block;
 }
 .xlbs-score-xx {
 	vertical-align: middle;
 	display: inline-block;
 }
 .xlbs-score-xx img {
 	width: 1.5em;
 	margin-right: .5em;
 }
 
 .xlform-btn {
 	padding: 1em .8em 0;
 }
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">晒单</h1>
	</div>
</div>
<div class="xlbody-box">
	<form id="shareFormEle">
		<div class="xlsf-p1">
			<img src="../../image/img/gongxi.jpg">
		</div>
		<div class="xlsf-p2">
			<div class="xlsf-s1">感应</div>
			<textarea placeholder="100个字以内" id="content"></textarea>
		</div>
		<div class="xlsf-p3">
			<div class="xlsf-s2 clearfix">
				<img src="../../image/img/tjzp.png"/>
				<img src="../../image/img/tjzp.png"/>
				<img src="../../image/img/tjzp.png"/>
			</div>
			<div class="xlsf-s3">最多上传3张照片</div>
		</div>
		
		<div class="xlbs-score" id="merchantsScore">
			<h3>商家评分</h3>
			<div class="xlbs-score-row">
				<span class="xlbs-score-tt">商品质量： </span>
				<span class="xlbs-score-xx scoreImgBox">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
				</span>
			</div>
			<div class="xlbs-score-row">
				<span class="xlbs-score-tt">商家服务： </span>
				<span class="xlbs-score-xx scoreImgBox">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
				</span>
			</div>
			<div class="xlbs-score-row">
				<span class="xlbs-score-tt">发货速度： </span>
				<span class="xlbs-score-xx scoreImgBox">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
					<img src="../../image/icon/Star.png">
				</span>
			</div>
		</div>
	</form>
	<div class="xlform-btn">			
		<button class="xl-btn xl-btn-block" onclick="shareSubmitFn()">晒一下</button>
	</div>
</div>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/md5.js"></script>
<script src="../../script/city.min.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script>
"use strict";
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});
//页面启动时，数据初始化
function pageDataInit(){
	globalData.imagePath = ['', '', ''];
	//评分初始化
	globalData.scoreArr = [5,4,5];
	$.each(globalData.scoreArr, function(index ,num){
		var str = '';
		for(var i = 0; i < 5; i++){
			if(i < num){
				str += '<img class="active" src="../../image/icon/Star.png">';
			}else{
				str += '<img src="../../image/icon/Star01.png">';
			}
		}
		$('.scoreImgBox')[index].innerHTML = str;
	});
}
//dom事件绑定
function domEventFn(){
	//评分点击效果
	$('.scoreImgBox').find('img').on('click', function(){
		var $me = $(this),
			box = $me.parents('.scoreImgBox'),
			imgs = box.find('img'),
			bImgs = $me.prevAll('img');
		imgs.removeClass('active').attr('src', '../../image/icon/Star01.png');
		bImgs.addClass('active').attr('src', '../../image/icon/Star.png');
		$me.addClass('active').attr('src', '../../image/icon/Star.png');
	});
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
}
//刷新之后执行函数
function refreshAfterFn(){
	//线性请求完成之后执行
	if(globalData.refreshComplete >= globalData.requestNum){
		globalData.refreshComplete = 0;//用来记录请求完成次数
		globalData.requestNum = 0;//用来记录有多少次用户请求
		//手动刷新界面，比如下拉刷新
		if(globalData.isRefresh == true){
			globalData.isRefresh = false;
			Common.toast('刷新成功');
		}
	}
}


//提交分享
function shareSubmitFn(){
	var titleStr = '',
		content = $('#content'),
		contentStr = content.val(),
		imagePath = globalData.imagePath,
		spellbuyId = globalData.pageParam.spellBuyId;
	if(!contentStr){
		Common.toast('写写你的故事吧！');
		content.focus();
		return false;
	}
	if(contentStr.length > 100){
		Common.toast('请输入1-100个字的评论内容');
		content.focus();
		return false;
	}
	if(!imagePath[0] && !imagePath[1] && !imagePath[2]){
		Common.toast('请至少上传一张图片');
		return false;
	}
	var scoreArr = [];
	$('.scoreImgBox').each(function(){
		scoreArr.push($(this).find('img.active').length);
	});
	var _url = '/ushop-api-merchant/api/spellbuy/person/share/private/submit',
		_param = {
			"spellbuyId": spellbuyId,
			"title": titleStr,
			"content": contentStr,
			"score": scoreArr,
			"files": imagePath
		};
	Common.ajax(_url, 'post', JSON.stringify(_param), function(data){
		if (data.share) {
			Common.toast('晒单成功');
		}
	});
}

</script>
</body>
</html>
