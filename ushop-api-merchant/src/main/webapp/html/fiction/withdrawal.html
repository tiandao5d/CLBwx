<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>账单提现</title>
<link rel="stylesheet" type="text/css" href="../../css/style.css?v=20180131"/>
<style>
.xlcb-li {
	position: relative;
	padding: 8px 15px;
	color: #535353;
	background: #fff;
	line-height: 20px;
}
.xlcb-li:after {
	content: '';
	position: absolute;
	left: 0;
	right: 0;
	bottom: 0;
	height: 1px;
	background: #a0a0a0;
	-webkit-transform: scaleY(.5);
	transform: scaleY(.5);
}
.xlcb-li:last-child:after {
	content: normal;
}
.xlcb-li .xllr-l {
	padding-right: 30%;
}
.xlcb-li .xllr-r {
	width: 62px;
	text-align: center;
	top: 50%;
	-webkit-transform: translateY(-50%);
	transform: translateY(-50%);
}
.xlcb-p1 {
	color: #959595;
}
.xlcb-li .xllr-r .xl-btn {
	color: #ff7200;
	background: #fff;
	padding: 8px;
	width: 100%;
	border: solid 1px #ff7200;
}
.xlcb-li .xllr-r i {
	color: #ff3502;
}
.xlcb-li .xllr-r span {
	color: #00a2ff;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">账单提现</h1>
	</div>
</div>
<div class="xlbody-box">
	<div id="withdrawal_box">
		<div class="tabBody"></div>
		<div class="xl-refresh-prompt refreshPrompt"></div>
	</div>
</div>
<script id="withdrawal_template" type="text/template">
	{{~it:data}}
		<div class="xlcb-li">
			<div class="xllr-box">
				<div class="xllr-l">
					<div class="ellipsis">总金额：{{=data.total}}</div>
					<div class="ellipsis xlcb-p1">{{=data.month}}</div>
				</div>
				<div class="xllr-r">
					{{?data.status === 1}}
					<button class="xl-btn" onclick="getWithdrawal({{=data.id}})">提现</button>
					{{??data.status === 2}}
					<i>审核中…</i>
					{{??data.status === 3}}
					<span>打款中</span>
					{{??data.status === 4}}
					<span>已打款</span>
					{{??data.status === 5}}
					<span>打款失败</span>
					{{??}}
					<span>未知错误</span>
					{{?}}
				</div>
			</div>
		</div>
	{{~}}
</script>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/md5.js"></script>
<script src="../../script/doT.min.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script>
"use strict";
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});

//页面启动时，数据初始化
function pageDataInit(){
}
//dom事件绑定
function domEventFn(){
	//到底部加载
	Common.scrollBottom(function(){
		getWdlDataFn();
	});
}

//所有需要从服务器加载的数据请求
function reloadDataFn(){
	getWdlDataFn();
}

//数据请求
function getWdlDataFn(){
	var suffixStr = 'wdl',
		listItem = $('#withdrawal_box'),//列表项目
		listContent = listItem.find('.tabBody'),//列表容器
		refreshPrompt = listItem.find('.refreshPrompt'),//加载中提示容器
		template = document.getElementById('withdrawal_template'),
		currentPage = globalData['currentPage' + suffixStr] || 0,//如果有传输查询过来为重新查询
		pagePage = globalData['pagePage' + suffixStr] || 1,
		typenum;//用来确定请求的地址
		
	if(refreshPrompt.find('.isLoadingTrue').length > 0){//说明正在加载中……
		return false;
	}
	currentPage++;
	if(currentPage > pagePage){//说明已经是最后一页了
		return false;
	}
	refreshPrompt.html(Common.listLoadingHTML());
	var _url = '/ushop-api-merchant/api/user/bill/listBy/' + currentPage + '/10';
	Common.ajax(_url, 'get', {}, function(data){
		if(data.totalCount >= 0){//表示数据请求成功
			currentPage = data.currentPage;
			pagePage = data.pagePage;
			globalData['currentPage' + suffixStr] = currentPage;
			globalData['pagePage' + suffixStr] = pagePage;
			if(data.totalCount === 0){//表示请求到的数据为0
				listContent.html('');
				refreshPrompt.html('没有数据');
				return false;
			}
			if(currentPage < pagePage){
				refreshPrompt.html('上拉加载');
			}else{
				refreshPrompt.html('没有更多了');
			}
			
			
			var dataListTemplate = doT.template(template.innerHTML);
			if(currentPage == 1){//说明是这个项目容器第一页
				listContent[0].innerHTML = dataListTemplate(data.recordList);
			}else{
				listContent[0].innerHTML += dataListTemplate(data.recordList);
			}
		}else{
			refreshPrompt.html('加载失败！');
		}
	}, false);
}

//提现
function getWithdrawal(id){
	if(!id){return false;}
	var _url = '/ushop-api-merchant/api/user/bill/deposit/' + id;
	Common.ajax(_url, 'get', {}, function(data){
		if(data.result === 'SUCCESS'){
			Common.toast('操作成功');
		}else{
			Common.toast(data.error_description || '未知错误');
		}
	});
}

</script>
</body>
</html>
