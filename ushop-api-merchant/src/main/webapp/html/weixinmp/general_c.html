<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>推广员</title>
<link rel="stylesheet" href="../../css/style.css?v=20180131"/>
<style>
/*banner样式*/
.xlgc-box1 {
    position: relative;
}
.xlgc-img1 {
    width: 100%;
}
.xlgc-p1 {
    position: absolute;
    top: 41%;
    bottom: 48%;
    left: 36%;
    right: 37%;
}
.xlgc-p2 {
    position: absolute;
    top: 83.555%;
    bottom: 9.444%;
    left: 9.634%;
    right: 57.777%;
}
.xlgc-p3 {
    position: absolute;
    top: 83.555%;
    bottom: 9.444%;
    left: 58.055%;
    right: 9.166%;
}
.xlgc-p1,
.xlgc-p2,
.xlgc-p3 {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 1.2em;
}
.xlgc-p1 {
    color: #8a2700;
    font-size: 2em;
}


/*分享样式*/
.xlmenu-box {
	background: none;
	padding: 2em 0;
}
.xlmenu-box .xlmenu-item {
	width: 33.3333%;
}
.xlgc-f1 {
	text-align: right;
	opacity: 1;
	background: rgba(0,0,0,.8);
}
.xlgc-f1 img {
	width: 34%;
	margin-right: 4%;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">推广员</h1>
	</div>
</div>
<div class="xlbody-box">
    <div class="xlgc-box1">
        <img class="xlgc-img1" src="../../image/img/general_icon001.png">
		<div id="userGenerInfo">
	        <div class="xlgc-p1">00</div>
	        <div class="xlgc-p2">00</div>
	        <div class="xlgc-p3">00</div>
		</div>
    </div>
    <div style="height: 1em;"></div>
	<ul class="xl-ul">
		<li class="xl-li xlli-menu-right xl-lii">
			<a onclick="Common.toast('功能开发中')">
				<img class="xl-li-img" src="../../image/img/general_icon007.png">
				<div class="xl-li-txt">推广排行</div>
			</a>
		</li>
		<li class="xl-li xlli-menu-right xl-lii">
			<a onclick="goTodetailFn()">
				<img class="xl-li-img" src="../../image/img/general_icon006.png">
				<div class="xl-li-txt">推广明细</div>
			</a>
		</li>
		<li class="xl-li xlli-menu-right xl-lii">
			<a href="../generalize/general_state.html">
				<img class="xl-li-img" src="../../image/img/general_icon005.png">
				<div class="xl-li-txt">推广帮助</div>
			</a>
		</li>
	</ul>
	<div class="xlmenu-box clearfix">
		<div class="xlmenu-item">
			<a onclick="onClickShareFn()">
				<div class="xl-badge-box">
					<img  class="xl9g-img" src="../../image/img/general_icon008.png">
				</div>
				<span class="xl9g-text">朋友圈</span>
			</a>
		</div>
		<div class="xlmenu-item">
			<a onclick="onClickShareFn()">
				<div class="xl-badge-box">
					<img  class="xl9g-img" src="../../image/img/general_icon009.png">
				</div>
				<span class="xl9g-text">好友</span>
			</a>
		</div>
		<div class="xlmenu-item">
			<a onclick="qrcodeFn()">
				<div class="xl-badge-box">
					<img  class="xl9g-img" src="../../image/img/general_icon010.png">
				</div>
				<span class="xl9g-text">二维码</span>
			</a>
		</div>
	</div>
</div>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/jquery.qrcode.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="../../script/md5.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script>
"use strict";
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});
//页面启动时，数据初始化
function pageDataInit(){
}
//dom事件绑定
function domEventFn(){
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
	//微信授权
	if(Common.isWeixin()){
		wxAuthoriseFn();//微信授权jsSDK
	}
	generalizeFZ();//推广员数据请求
}


//请求推广员信息
function generalizeFZ(){
	Common.generalL(function(data){
    	if(data.id){
			var str =
		        '<div class="xlgc-p1">' + (parseInt(data.monthlyRebates) + parseInt(data.monthlyRewards)) + '</div>'+
		        '<div class="xlgc-p2">' + (parseInt(data.rebates) + parseInt(data.rewards)) + '</div>'+
		        '<div class="xlgc-p3">' + data.subordinate + '/' + data.secondary + '</div>';
			document.getElementById('userGenerInfo').innerHTML = str;
    	}else if(data.error_description){
    		Common.toast(data.error_description);
    	}else{
    		Common.toast('数据请求错误');
    	}
	});
}

//进入想起
function goTodetailFn(showItem){
	Common.openPage('../generalize/general_detail_c.html', {showItem: showItem});
}

//生成二维码
function qrcodeFn(val){
	var str = '<div style="text-align: center;"><div id="qrcodeEle" style="width: 200px; height: 200px; display: inline-block;"></div></div>';
	Common.confirm('提示', str, null, '确定');
	var codeStr = (Common.domainUrl + '/ushop-api-merchant/html/weixinmp/index.html?promoter=' + Common.getUserId());
	$('#qrcodeEle').qrcode({width: 200,height: 200,text: codeStr});
}


//微信授权接口
function wxAuthoriseFn(){
	var _url =  Common.domainUrl + '/ushop-api-merchant/api/weixin/client/ticket/get?'+
				'type=jsapi&url=' + document.URL;
	Common.ajax(_url, 'get', {}, function(data) {
		if(data.sign){
			configFn(data.timestamp, data.noncestr, data.sign);
		}
	});
}

//微信配置接口
//configFn(1495764791, 'Kmifefp2whjxfbst', '7ebdce4d83faadb22e3d0d277bcaefe0cd08514e');
function configFn(timestamp, nonceStr, signature){
	wx.config({
	    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
	    appId: Common.getAppId(), // 必填，公众号的唯一标识
	    timestamp: timestamp, // 必填，生成签名的时间戳
	    nonceStr: nonceStr, // 必填，生成签名的随机串
	    signature: signature,// 必填，签名，见附录1
	    jsApiList: [// 必填，需要使用的JS接口列表，所有JS接口列表见附录2
	        'onMenuShareTimeline',//获取“分享到朋友圈”按钮点击状态及自定义分享内容接口
	        'onMenuShareAppMessage'//获取“分享给朋友”按钮点击状态及自定义分享内容接口
	    ]
	});
}

//微信初始化完成执行
wx.ready(function(){
	//获取“分享到朋友圈”按钮点击状态及自定义分享内容接口
	wx.onMenuShareTimeline({
	    title: '注册彩乐宝 领彩豆好礼', // 分享标题
	    // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
	    link: (Common.domainUrl + '/ushop-api-merchant/html/weixinmp/index.html?promoter=' + Common.getUserId()),
	    imgUrl: (Common.domainUrl + '/ushop-api-merchant/image/icon/logoicon.png'), // 分享图标
	    success: function () {
	        Common.toast('分享成功！');
	    },
	    cancel: function () { 
	        Common.toast('用户取消！');
	    }
	});
	
	//获取“分享给朋友”按钮点击状态及自定义分享内容接口
	wx.onMenuShareAppMessage({
	    title: '注册彩乐宝 领彩豆好礼', // 分享标题
	    desc: '好友邀请您注册彩乐宝，双赢好礼一起抢，10彩豆即可中Iphone7哦~！', // 分享描述
	    // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
	    link: (Common.domainUrl + '/ushop-api-merchant/html/weixinmp/index.html?promoter=' + Common.getUserId()),
	    imgUrl: (Common.domainUrl + '/ushop-api-merchant/image/icon/logoicon.png'), // 分享图标
	    type: 'link', // 分享类型,music、video或link，不填默认为link
	    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
	    success: function () { 
	        Common.toast('分享成功！');
	    },
	    cancel: function () { 
	        Common.toast('用户取消！');
	    }
	});
});

//点击分享提示
function onClickShareFn(){
	var div = $('<div onclick="$(this).remove()" class="xl-modal-bg xlgc-f1"></div>');
	div.html('<img src="../../image/img/general_img005.png">');
	div.appendTo('body');
}
</script>
</body>
</html>
