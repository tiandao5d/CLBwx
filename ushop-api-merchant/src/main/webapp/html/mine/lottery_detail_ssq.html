<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>双色球</title>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<meta name = "format-detection" content="telephone = no" />
<link rel="stylesheet" type="text/css" href="../../css/style.css?v=20180131"/>
<style>
.xlld-box1 {
    background: #ffebed;
}
.xlld-title {
    font-size: 1.4em;
    line-height: 2.4em;
    text-align: center;
    font-weight: bold;
}
.xllr {
    position: relative;
    padding: .5em .8em;
}
.xllr .xll {
    min-height: 1em;
}
.xllr .xlr {
    position: absolute;
    top: 50%;
    right: .8em;
    margin-top: -.5em;
}
.xlld-p1 {
    padding: .3em .8em;
    font-weight: bold;
}
.xlld-p2 {
    font-weight: bold;
    text-align: right;
    padding: .5em .8em;
}
.xlld-p3 {
    padding: 0 .8em;
}

.xlld-box2 {
    padding: 1em;
}
.xlld-box2 .xl-btn {
    float: right;
    background: #ff5534;
    border: 0;
    border-radius: .3em;
    padding: .8em 1.6em;
    color: #fff;
}
.xlld-box2 .xl-btn:first-child {
    float: left;
}

.xlld-box3 {
    position: relative;
    padding: .5em .8em;
    background: #fff;
}
.xlld-box3 .icon-forward {
    position: absolute;
    top: 50%;
    right: .8em;
    margin-top: -.5em;
    font-size: 2em;
}
.xlld-box3 .xlld-p4 span {
    float: left;
    height: 2em;
    width: 2em;
    border-radius: 2em;
    background: #fe0000;
    text-align: center;
    line-height: 2em;
    color: #fff;
    margin-left: .5em;
}
.xlld-box3 .xlld-p4 span:first-child {
    margin-left: 0;
}
.xlld-box3 .xlld-p4 span.blue {
    background: #00b8ee;
}
.xlld-box2 .xl-btn {
	position: relative;
}
.xlld-box2 .xl-btn .caret {
	position: absolute;
	top: 50%;
	margin-top: -2px;
	right: 8px;
}
.xlld-down {
	position: absolute;
	left: 5%;
	top: 90%;
	width: 90%;
	height: 0;
	overflow: hidden;
	background: #fff;
	border-radius: .5em;
	transition: all .3s;
}
.xlld-down a {
	display: block;
	line-height: 24px;
	text-align: center;
	color: #545454;
	border-top: solid 1px #ccc;
}
.xlld-down a:first-child {
	border-top-color: transparent;
}
.xlld-p5 {
	text-align: center;
	color: #ff5534;
}
</style>
</head>
<body>
<div class="xlnav-box xlele-box">
	<div class="xlnav-content xlele-content">
		<img src="../../image/icon/titleBG.jpg">
		<h1 class="xlnav-title">双色球</h1>
	</div>
</div>
<div class="xlbody-box">
    <div class="xlld-box1">
        <div class="xlld-title">双色球</div>
        <div id="lotteryCode"></div>
        <div style="height: 1em;"></div>
    </div>
    <div style="height: 3px;"></div>
    <div class="xlld-box3 hidden" id="drawNumbers"></div>
    <div style="height: 1em;"></div>
    <div class="lottery_limit xlld-p5">恭喜您获得00双色球积分，您今日的双色球扫票次数还剩00次!</div>
    <div style="height: 1em;"></div>
    <div class="xlld-box2 clearfix">
        <div class="xl-btn slid_btn_box">
        	扫描记录<span class="caret"></span>
        	<div class="xlld-down">
        		<a href="../game/game_list.html">积分玩游戏</a>
        		<a href="../weixinmp/shopping_ds.html">积分兑商品</a>
        	</div>
        </div>
        <a class="xl-btn" href="../weixinmp/home.html?scanQRCode=yes">继续扫描</a>
    </div>
</div>

<script id="listTemplate"  type="text/template">
    {{?(it.playTypeID == '3000')}}
    <div class="xlld-game-type">
        <div class="xllr">
            <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
            <div class="xlr">玩法：单式</div>
        </div>
        {{~it.bets:item:ii}}
        <div class="xlld-p1">{{=((ii + 10).toString(16)).toLocaleUpperCase()}}. {{=item.numArr[0]}}　{{=item.numArr[1]}}　{{=item.numArr[2]}}　{{=item.numArr[3]}}　{{=item.numArr[4]}}　{{=item.numArr[5]}} + {{=item.numArr[6]}}　【{{=item.multiTimes}}倍】</div>
        {{~}}
    </div>
    {{??(it.playTypeID == '3001')}}
    <div class="xlld-game-type">
        <div class="xllr">
            <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
            <div class="xlr">玩法：复式</div>
        </div>
        {{~it.bets:item}}
        <div class="xlld-p1">{{=item.numR1Txt}}：{{~item.numArrR1:v1}}{{=v1}}　{{~}}</div>
        <div class="xlld-p1">{{=item.numB1Txt}}：{{~item.numArrB1:v2}}{{=v2}}　{{~}}</div>
        <div class="xlld-p1">倍数：{{=item.multiTimes}}</div>
        {{~}}
    </div>
    {{??((it.playTypeID == '3003') || (it.playTypeID == '3002'))}}
    <div class="xlld-game-type">
        <div class="xllr">
            <div class="xll">第 <span class="color-ff5534">{{=it.issue}}</span> 期</div>
            <div class="xlr">玩法：胆拖</div>
        </div>
        {{~it.bets:item}}
        <div class="xlld-p1">红胆：{{~item.numArrR1:v1}}{{=v1}}　{{~}}</div>
        <div class="xlld-p1">红拖：{{~item.numArrR2:v2}}{{=v2}}　{{~}}</div>
        <div class="xlld-p1">{{=item.numB1Txt}}：{{~item.numArrB1:v3}}{{=v3}}　{{~}}</div>
        <div class="xlld-p1">倍数：{{=item.multiTimes}}</div>
        {{~}}
    </div>
    {{?}}
    <div class="xlld-p2">金额：{{=it.parValue}}元</div>
    <!-- <div class="xlld-p3">开奖时间：2017-02-02</div>
    <div class="xlld-p3">兑奖有效期：2017-02-02</div> -->
</script>
<script src="../../script/jquery-1.12.4.min.js"></script>
<script src="../../script/doT.min.js"></script>
<script src="../../script/common.js?v=20180131"></script>
<script src="../../script/defaultxl.js?v=20180131"></script>
<script>
"use strict";
globalData.isProgress = false;
$(function() {
	globalData.loadReady();//页面加载完成执行
	pageDataInit();//页面数据初始化
	domEventFn();//dom初始化事件绑定
	reloadDataFn();//所有需要从服务器加载的数据请求
});
//页面启动时，数据初始化
function pageDataInit(){
    var lotteryData,
        numStr = '',
        numCode;
    try{
    	lotteryData = JSON.parse(decodeURIComponent(globalData.pageParam.lotteryData));
    	lotteryData.bets = JSON.parse(lotteryData.bets);
    }catch(err){
    	return false;
    }
    console.log(lotteryData)
    lotteryData.playTypeID = lotteryData.bets[0].playTypeID;
    $.each(lotteryData.bets, function(index, obj){
        obj.numArr = [];
        $.each(obj.betNum.split(''), function(i, v){
            if(i%2 == 0){
                numStr = (v + '');
            }else{
                numStr += (v + '');
                numCode = parseInt(numStr, 16);
                if(numCode < 10){
                    numCode = ('0' + numCode);
                }else{
                    numCode = ('' + numCode);
                }
                obj.numArr.push(numCode);
            }
        });
        if(obj.playTypeID == '3001'){//复式
            var c1 = parseInt(obj.numArr[0]);
            obj.numArrR1 = obj.numArr.slice(1, (1 + c1));
            obj.numArrB1 = obj.numArr.slice(1 + c1);
            c1 = parseInt(obj.numArrB1[0]);
            obj.numArrB1 = obj.numArrB1.slice(1, (1 + c1));
            if(obj.numArrR1.length > 6){
                obj.numR1Txt = '红复';
            }else{
                obj.numR1Txt = '红单';
            }
            if(obj.numArrB1.length > 1){
                obj.numB1Txt = '蓝复';
            }else{
                obj.numB1Txt = '蓝单';
            }
        }
        if((obj.playTypeID == '3003') || (obj.playTypeID == '3002')){//胆拖
            var c1 = parseInt(obj.numArr[0]);
            obj.numArrR1 = obj.numArr.slice(1, (1 + c1));
            obj.numArrR2 = obj.numArr.slice(1 + c1);
            c1 = parseInt(obj.numArrR2[0]);
            obj.numArrB1 = obj.numArrR2.slice(1 + c1);
            obj.numArrR2 = obj.numArrR2.slice(1, (1 + c1));
            c1 = parseInt(obj.numArrB1[0]);
            obj.numArrB1 = obj.numArrB1.slice(1, (1 + c1));
            if(obj.numArrB1.length > 1){
                obj.numB1Txt = '蓝复';
            }else{
                obj.numB1Txt = '蓝单';
            }
        }
    });
    if(lotteryData.prizeStat == 11 || lotteryData.prizeStat == 12){//未中奖和已中奖状态可查询中奖信息
        getWinNumberFn(lotteryData.province, lotteryData.platform, lotteryData.gameId, lotteryData.issue, lotteryData.featureCode);
    }
    var dataListTemplate = doT.template(document.getElementById('listTemplate').innerHTML);
    document.getElementById('lotteryCode').innerHTML = dataListTemplate(lotteryData);
    document.querySelector('.lottery_limit').innerText =
    	'恭喜您获得' + (lotteryData.reward || '00') + '双色球积分，您今日的双色球扫票次数还剩' + (lotteryData.limit || '00') + '次!';
}
//dom事件绑定
function domEventFn(){
	var $box = $('.slid_btn_box'),
		$down = $box.find('.xlld-down');
	$box.on('click', function(e){
		var $me = $(this),
			box = $me.find('.xlld-down'),
			h = box[0].scrollHeight;
		if($me.hasClass('active')){
			$me.removeClass('active');
			box.css({
				'height': '0'
			});
		}else{
			$me.addClass('active');
			box.css({
				'height': h + 'px'
			});
		}
	});
}
//所有需要从服务器加载的数据请求
function reloadDataFn(){
}

//刷新之后执行函数
function refreshAfterFn(){
	//说明页面所有请求都已经完成
	if(globalData.refreshComplete >= globalData.requestNum){
		globalData.refreshComplete = 0;//用来记录请求完成次数，记录归零
		globalData.requestNum = 0;//用来记录有多少次用户请求，记录归零
		if(globalData.isRefresh == true){
			globalData.isRefresh = false;
			Common.toast('刷新成功');
		}
	}
}


//获取开奖信息
function getWinNumberFn(province, platform, game, issue, lotteryCode){
    var _url = '/ushop-api-merchant/api/caipiao/hotline/ticket/draw/get/' + province + '/' + platform + '/' + game + '/' + issue + '/' + lotteryCode;
    Common.ajax(_url, 'post', {}, function(data){
        if(data.gameId){
            var numArr = JSON.parse(data.numbers),
                drawNumbers = document.getElementById('drawNumbers'),
                winNum;
            data.numArr1 = [];
            Common.each(numArr, function(index, obj){
                winNum = parseInt(obj.winNum);
                data.numArr1[(parseInt(obj.numSN) - 1)] = ((winNum < 10) ? ('0' + winNum) : ('' + winNum));
            });
            var str =
                    '<div>第 <span class="xlcolor-ff5534">' + data.issue + '</span> 期</div>'+
                    '<div style="height: .6em;"></div>'+
                    '<div class="xlld-p4 clearfix">'+
                        '<span>' + data.numArr1[0] + '</span>'+
                        '<span>' + data.numArr1[1] + '</span>'+
                        '<span>' + data.numArr1[2] + '</span>'+
                        '<span>' + data.numArr1[3] + '</span>'+
                        '<span>' + data.numArr1[4] + '</span>'+
                        '<span>' + data.numArr1[5] + '</span>'+
                        '<span class="blue">' + data.numArr1[6] + '</span>'+
                    '</div>'+
                    '<span class="icon icon-forward"></span>';
            drawNumbers.innerHTML = str;
            drawNumbers.classList.remove('hidden');
        }
    });
}

</script>
</body>
</html>
